<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>JSON</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="scheme.css" title="default" /><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default" /><script type="text/javascript" src="scribble-common.js"></script></head><body id="scribble-plt-scheme-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="/" class="tocviewselflink"><span style="font-weight: bold">JSON</span></a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="/#(part._jsexprs)" class="tocviewlink">JS-<wbr></wbr>Expressions</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="/#(part._rationale)" class="tocviewlink">A word about design</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#(part._jsexprs)" class="tocsubseclink">JS-<wbr></wbr>Expressions</a></td></tr><tr><td><a href="#(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr~3f))" class="tocsubnonseclink"><span title="Provided from: (planet dherman/json:3:0)"><span class="ScmSym"><span class="ScmValLink">jsexpr?</span></span></span></a></td></tr><tr><td><a href="#(def._((planet._main..ss._(dherman._json..plt._3._0))._read-json))" class="tocsubnonseclink"><span title="Provided from: (planet dherman/json:3:0)"><span class="ScmSym"><span class="ScmValLink">read-<wbr></wbr>json</span></span></span></a></td></tr><tr><td><a href="#(def._((planet._main..ss._(dherman._json..plt._3._0))._write-json))" class="tocsubnonseclink"><span title="Provided from: (planet dherman/json:3:0)"><span class="ScmSym"><span class="ScmValLink">write-<wbr></wbr>json</span></span></span></a></td></tr><tr><td><a href="#(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr-~3ejson))" class="tocsubnonseclink"><span title="Provided from: (planet dherman/json:3:0)"><span class="ScmSym"><span class="ScmValLink">jsexpr-<wbr></wbr>&gt;json</span></span></span></a></td></tr><tr><td><a href="#(def._((planet._main..ss._(dherman._json..plt._3._0))._json-~3ejsexpr))" class="tocsubnonseclink"><span title="Provided from: (planet dherman/json:3:0)"><span class="ScmSym"><span class="ScmValLink">json-<wbr></wbr>&gt;jsexpr</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#(part._rationale)" class="tocsubseclink">A word about design</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><h2><a name="(part._top)"></a><a name="(mod-path._(planet._dherman/json~3a3~3a0))"></a><span style="font-weight: bold">JSON</span></h2><p>by Dave Herman (<span class="stt">dherman at ccs dot neu dot edu</span>)</p><p>This library provides utilities for marshalling and unmarshalling data in the JSON data exchange format.
See the <a href="http://www.json.org">JSON web site</a> and the <a href="http://www.ietf.org/rfc/rfc4627.txt?number=4627">JSON RFC</a>
for more information about JSON.</p><p><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="ScmPn">(</span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZm9ybSBjIChjIChjIGxpYiBjICh1IC4gc2NoZW1lL2Jh%0D%0Ac2Uuc3MpKSBjIHJlcXVpcmUpKSk%3D%0D%0A" class="ScmStxLink">require</a></span><span class="stt"> </span><span class="ScmPn">(</span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZm9ybSBjIChjIChjIGxpYiBjICh1IC4gc2NoZW1lL2Jh%0D%0Ac2Uuc3MpKSBjIHBsYW5ldCkpKQ%3D%3D%0D%0A" class="ScmStxLink">planet</a></span><span class="stt"> </span><span class="ScmSym">dherman/json:3:0</span><span class="ScmPn">)</span><span class="ScmPn">)</span></td></tr></table></p><h3>1<tt>&nbsp;</tt><a name="(part._jsexprs)"></a>JS-Expressions</h3><p>This library defines a subset of Scheme values that can be represented as JSON strings.
A <a name="(tech._js._expression)"></a><span style="font-style: italic">JS-Expression</span>, or <a name="(tech._jsexpr)"></a><span style="font-style: italic">jsexpr</span>, is one of:</p><ul><li><p><span class="ScmVal">#\null</span></p></li><li><p><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBi%0D%0Ab29sZWFuPykpKQ%3D%3D%0D%0A" class="ScmValLink">boolean?</a></span></p></li><li><p><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBz%0D%0AdHJpbmc%2FKSkp%0D%0A" class="ScmValLink">string?</a></span></p></li><li><p><span class="ScmPn">(</span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZm9ybSBjIChjIChjIGxpYiBjICh1IC4gc2NoZW1lL3By%0D%0AaXZhdGUvbGV0c3R4LXNjaGVtZS5zcykpIGMgb3IpKSk%3D%0D%0A" class="ScmStxLink">or</a></span><span class="stt"> </span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBp%0D%0AbnRlZ2VyPykpKQ%3D%3D%0D%0A" class="ScmValLink">integer?</a></span><span class="stt"> </span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBp%0D%0AbmV4YWN0LXJlYWw%2FKSkp%0D%0A" class="ScmValLink">inexact-real?</a></span><span class="ScmPn">)</span></p></li><li><p><span class="ScmPn">(</span><span class="ScmSym">listof</span><span class="stt"> </span><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr~3f))" class="ScmValLink">jsexpr?</a></span><span class="ScmPn">)</span></p></li><li><p><span class="ScmPn">(</span><span class="ScmSym">hasheqof</span><span class="stt"> </span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBz%0D%0AeW1ib2w%2FKSkp%0D%0A" class="ScmValLink">symbol?</a></span><span class="stt"> </span><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr~3f))" class="ScmValLink">jsexpr?</a></span><span class="ScmPn">)</span></p></li></ul><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="ScmPn">(</span><a name="(dep._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr~3f))"></a><a name="(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr~3f))"></a><span title="Provided from: (planet dherman/json:3:0)"><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr~3f))" class="ScmValLink">jsexpr?</a></span></span><span class="hspace">&nbsp;</span><span class="ScmVar">x</span><span class="ScmPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBi%0D%0Ab29sZWFuPykpKQ%3D%3D%0D%0A" class="ScmValLink">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="ScmVar">x</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="ScmSym">any</span></td></tr></table></div><div class="SIntrapara">Performs a deep check to determine whether <span class="ScmVar">x</span> is a <a href="/#(tech._jsexpr)" class="techoutside"><span class="techinside">jsexpr</span></a>.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="ScmPn">(</span><a name="(dep._((planet._main..ss._(dherman._json..plt._3._0))._read-json))"></a><a name="(def._((planet._main..ss._(dherman._json..plt._3._0))._read-json))"></a><span title="Provided from: (planet dherman/json:3:0)"><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._read-json))" class="ScmValLink">read-json</a></span></span><span class="hspace">&nbsp;</span>[<span class="ScmVar">in</span>]<span class="ScmPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr~3f))" class="ScmValLink">jsexpr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="ScmVar">in</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBp%0D%0AbnB1dC1wb3J0PykpKQ%3D%3D%0D%0A" class="ScmValLink">input-port?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="ScmPn">(</span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBj%0D%0AdXJyZW50LWlucHV0LXBvcnQpKSk%3D%0D%0A" class="ScmValLink">current-input-port</a></span><span class="ScmPn">)</span></td></tr></table></div><div class="SIntrapara">Reads an immutable <a href="/#(tech._jsexpr)" class="techoutside"><span class="techinside">jsexpr</span></a> from a JSON-encoded input port <span class="ScmVar">in</span>.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="ScmPn">(</span><a name="(dep._((planet._main..ss._(dherman._json..plt._3._0))._write-json))"></a><a name="(def._((planet._main..ss._(dherman._json..plt._3._0))._write-json))"></a><span title="Provided from: (planet dherman/json:3:0)"><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._write-json))" class="ScmValLink">write-json</a></span></span><span class="hspace">&nbsp;</span><span class="ScmVar">x</span><span class="hspace">&nbsp;</span>[<span class="ScmVar">out</span>]<span class="ScmPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="ScmSym">any</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="ScmVar">x</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr~3f))" class="ScmValLink">jsexpr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="ScmVar">out</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBv%0D%0AdXRwdXQtcG9ydD8pKSk%3D%0D%0A" class="ScmValLink">output-port?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="ScmPn">(</span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBj%0D%0AdXJyZW50LW91dHB1dC1wb3J0KSkp%0D%0A" class="ScmValLink">current-output-port</a></span><span class="ScmPn">)</span></td></tr></table></div><div class="SIntrapara">Writes the <a href="/#(tech._jsexpr)" class="techoutside"><span class="techinside">jsexpr</span></a> <span class="ScmVar">x</span>, encoded as JSON, to output port <span class="ScmVar">out</span>.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="ScmPn">(</span><a name="(dep._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr-~3ejson))"></a><a name="(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr-~3ejson))"></a><span title="Provided from: (planet dherman/json:3:0)"><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr-~3ejson))" class="ScmValLink">jsexpr-&gt;json</a></span></span><span class="hspace">&nbsp;</span><span class="ScmVar">x</span><span class="ScmPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBz%0D%0AdHJpbmc%2FKSkp%0D%0A" class="ScmValLink">string?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="ScmVar">x</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr~3f))" class="ScmValLink">jsexpr?</a></span></td></tr></table></div><div class="SIntrapara">Generates a JSON source string for the <a href="/#(tech._jsexpr)" class="techoutside"><span class="techinside">jsexpr</span></a> <span class="ScmVar">x</span>.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="ScmPn">(</span><a name="(dep._((planet._main..ss._(dherman._json..plt._3._0))._json-~3ejsexpr))"></a><a name="(def._((planet._main..ss._(dherman._json..plt._3._0))._json-~3ejsexpr))"></a><span title="Provided from: (planet dherman/json:3:0)"><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._json-~3ejsexpr))" class="ScmValLink">json-&gt;jsexpr</a></span></span><span class="hspace">&nbsp;</span><span class="ScmVar">s</span><span class="ScmPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="ScmSym"><a href="/#(def._((planet._main..ss._(dherman._json..plt._3._0))._jsexpr~3f))" class="ScmValLink">jsexpr?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="ScmVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBz%0D%0AdHJpbmc%2FKSkp%0D%0A" class="ScmValLink">string?</a></span></td></tr></table></div><div class="SIntrapara">Parses the JSON string <span class="ScmVar">s</span> as an immutable <a href="/#(tech._jsexpr)" class="techoutside"><span class="techinside">jsexpr</span></a>.</div></p><h3>2<tt>&nbsp;</tt><a name="(part._rationale)"></a>A word about design</h3><p>Because JSON distinguishes syntactically between <span class="stt">null</span>, array literals, and object literals,
this library uses non-overlapping datatypes for the three corresponding variants of <a href="/#(tech._jsexpr)" class="techoutside"><span class="techinside">jsexpr</span></a>.</p><p>Since the Scheme null value <span class="ScmVal">'</span><span class="ScmVal">(</span><span class="ScmVal">)</span> overlaps with lists, there is no natural choice for the
<a href="/#(tech._jsexpr)" class="techoutside"><span class="techinside">jsexpr</span></a> represented as <span class="stt">null</span>. We prefer <span class="ScmVal">#\null</span> as the least objectionable
option from Scheme&rsquo;s host of singleton datatypes (note that the <span class="ScmRes">#&lt;void&gt;</span> and <span class="ScmRes">#&lt;undefined&gt;</span>
constants do not have <span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyBy%0D%0AZWFkKSkp%0D%0A" class="ScmValLink">read</a></span>able and <span class="ScmSym"><a href="/servlets/doc-search.ss?tag=KCgyKSAwICgpIDAgKCkgKCkgKGMgZGVmIGMgKGMgKGMgcXVvdGUgYyAjJWtlcm5lbCkgYyB3%0D%0Acml0ZSkpKQ%3D%3D%0D%0A" class="ScmValLink">write</a></span>able representations, which makes them
less convenient choices).</p><p>The <a href="http://www.ietf.org/rfc/rfc4627.txt?number=4627">JSON RFC</a> only states that object
literal expressions "SHOULD" contain unique keys, but does not proscribe them entirely. Looking at
existing practice, it appears that popular JSON libraries parse object literals with duplicate keys
by simply picking one of the key-value pairs and discarding the others with the same key. This
behavior is naturally paralleled by PLT Scheme hash tables, making them a natural analog.</p><p>Finally, the <a href="http://www.ietf.org/rfc/rfc4627.txt?number=4627">JSON RFC</a> is almost completely
silent about the order of key-value pairs. While the RFC only specifies the syntax of JSON, which of
course always must represent object literals as an ordered collection, the introduction states:</p><blockquote><p>An object is an unordered collection of zero or more name/value
pairs, where a name is a string and a value is a string, number,
boolean, null, object, or array.</p></blockquote><p>In practice, JSON libraries discard the order of object literals in parsed JSON text and make no
guarantees about the order of generated object literals. This again makes hash tables a good choice
for representing as JSON object literals.</p></div></div></body></html>